\section{Forgery algorithms}
  \begin{proposition}
  \label{prop:distrib}
    Let $k \in \mathbb{N}$, $p$ a polynomial an arbitrary distribution $T$ and
    the uniform distribution $U$ over a set $A$ of size $p(k)$. It is
    \begin{equation*}
      \Pr[T = U] = \frac{1}{p(k)}
    \end{equation*}
  \end{proposition}

  \begin{proof}
    \begin{gather*}
      \Pr[T = U] = \sum\limits_{a \in A}\Pr[T = a \wedge U = a] = \sum\limits_{a
      \in A}\frac{1}{p(k)}\Pr[U = a] =\\
      = \frac{1}{p(k)}\sum\limits_{a \in A}\Pr[U = a] = \frac{1}{p(k)}
    \end{gather*}
  \end{proof}

  \begin{figure}[H]
    \begin{algobox}{\textsf{EUF-CMA} forgery}
      $\adversary_{\mathrm{ds}}$(\textsc{init}, $pk$):
      \begin{itemize}
        \item Choose uniformly at random \alice{} from the set of players
        $\mathcal{P}$ of an execution
        $\textsc{Exec}^{\ledger}_{\Pi_{\mathrm{LN}}, \adversary_{\mathrm{d}},
        \environment}$
        \item Choose uniformly at random $i$ from $\{1, \dots, m\}$
        \item Simulate internally
        $\textsc{Exec}^{\ledger}_{\Pi_{\mathrm{LN}}, \adversary_{\mathrm{d}},
        \environment}$
        \item When \alice{} opens her $i$-th channel, replace $p_F$ of
        \textsc{KeyGen}() in Fig.~\ref{alg:protocol:support},
        line~\ref{alg:protocol:support:gen:fund} with $pk$
        \item Whenever \textsc{SignDS}($M, s_F$) is called, ask challenger for
        the signature $\sigma$ with (unknown) $sk$ on $M$ and use that instead
        \item If event $P$ takes place, retrieve forged signature $\sigma^*$ and
        the corresponding transaction $m^*$ and output $(m^*, \sigma^*)$
        \item If the simulated execution completes and \alice{} has opened less
        than $i$ channels, or if no forgery happened, or if a forgery for
        another player/channel happened, return \textsc{fail}
      \end{itemize}
    \end{algobox}
    \caption{wins \textsf{EUF-CMA} game}
    \label{alg:forge:ds}
  \end{figure}

  \begin{proposition}
  \label{prop:forgery:ds}
    If $\Pr[P] = a$, then $\Pr[\adversary_{\mathrm{ds}} \text{ wins }
    \mathsf{EUF \mhyphen CMA}] = \frac{a}{nm}$
  \end{proposition}

  \begin{proof}
    $\adversary_{\mathrm{ds}}$ simulates
    $\textsc{Exec}^{\ledger}_{\Pi_{\mathrm{LN}}, \adversary_{\mathrm{d}},
    \environment}$ faithfully, since it does the following two changes. The
    first is to replace one $p_F$ public key with the public key $pk$ given by
    the challenger. Both keys are generated by \textsc{KeyGen}(), thus their
    distribution is identical. The second is to replace signatures done by $s_F$
    with signatures done by the challenger with $sk$. Both signatures are
    generated with \textsc{SignDS}() and thus their distribution is identical.
    We deduce that, within the simulated execution, $\Pr[P] = a$.

    At the beginning of an execution, \alice{} and $i$ are chosen uniformly at
    random, therefore given $P$, by Proposition~\ref{prop:distrib} we have that
    \begin{equation*}
      \Pr[\adversary_{\mathrm{ds}} \text{ chooses correct keypair}] =
      \frac{1}{nm} \enspace.
    \end{equation*}
    Since the selection happens independently from the forgery, we deduce that
    \begin{equation*}
      \Pr[\adversary_{\mathrm{ds}} \text{ wins } \mathsf{EUF \mhyphen CMA}] =
      \frac{a}{nm}
    \end{equation*}
  \end{proof}

  \begin{figure}[H]
    \begin{algobox}{\textsf{IBS-EUF-CMA} forgery}
      $\adversary_{\mathrm{ibs}}$(\textsc{init}, $mpk$):
      \begin{itemize}
        \item Choose uniformly at random \alice{} from the set of players
        $\mathcal{P}$ of an execution
        $\textsc{Exec}^{\ledger}_{\Pi_{\mathrm{LN}}, \adversary_{\mathrm{d}},
        \environment}$
        \item Choose uniformly at random $i$ from $\{1, \dots, p\}$
        \item Choose uniformly at random $j$ from $\{\mathrm{pay},
        \mathrm{dpay}, \mathrm{htlc}\}$
        \item Simulate internally
        $\textsc{Exec}^{\ledger}_{\Pi_{\mathrm{LN}}, \adversary_{\mathrm{d}},
        \environment}$
        \item When \alice{} performs her $i$-th opening or update, replace the
        $ph_{j, n}$ output of \textsc{KeyDer}$(phb_j, shb_j, ph_{\mathrm{com},
        n})$ with \textsc{PubKeyDer}$(mpk, ph_{\mathrm{com}, n})$
        \item Whenever \textsc{SignIBS}($M, sh_{j, n}$) is called, ask
        challenger for the signature $\sigma$ with (unknown) $sk \gets
        \textsc{KeyDer}(mpk, msk, ph_{\mathrm{com}, n})$ on $M$ and use that
        instead
        \item If event $Q$ takes place, retrieve forged signature $\sigma^*$ and
        the corresponding transaction $m^*$ and output $(m^*, ph_{\mathrm{com},
        n},\sigma^*)$
        \item If the simulated execution completes and \alice{} has updated or
        opened a channel less than $i$ times, or if no forgery happened, or if a
        forgery for another player/opening/update happened, return \textsc{fail}
      \end{itemize}
    \end{algobox}
    \caption{wins \textsf{IBS-EUF-CMA} game}
    \label{alg:forge:ibs}
  \end{figure}

  \begin{proposition}
  \label{prop:forgery:ibs}
    If $\Pr[Q] = b$, then $\Pr[\adversary_{\mathrm{ibs}} \text{ wins }
    \mathsf{IBS \mhyphen EUF \mhyphen CMA}] = \frac{b}{3np}$
  \end{proposition}

  \begin{proof}
    $\adversary_{\mathrm{ibs}}$ simulates
    $\textsc{Exec}^{\ledger}_{\Pi_{\mathrm{LN}}, \adversary_{\mathrm{d}},
    \environment}$ faithfully, since it does the following two changes. The
    first is to replace one $ph_{j, n}$ public key with the public key $pk \gets
    \textsc{PubKeyDer}(mpk, ph_{\mathrm{com}, n})$, where $mpk$ is given by the
    challenger. Both $mpk$ and the normally used $phb_j$ are generated by
    \textsc{KeyDer}(), thus their distribution is identical. The second is to
    replace signatures done by $sh_{j, n}$ with signatures done by the
    challenger with $sk \gets \textsc{KeyDer}(mpk, msk, ph_{j, n}$. Both
    signatures are generated with \textsc{SignIBS}() and thus their distribution
    is identical. We deduce that, within the simulated execution, $\Pr[Q] = b$.

    At the beginning of an execution, \alice, $i$ and $j$ are chosen uniformly
    at random, therefore given $Q$, by Proposition~\ref{prop:distrib} we have
    that
    \begin{equation*}
      \Pr[\adversary_{\mathrm{ibs}} \text{ chooses correct keypair}] =
      \frac{1}{3np} \enspace.
    \end{equation*}
    Since the selection happens independently from the forgery, we deduce that
    \begin{equation*}
      \Pr[\adversary_{\mathrm{ibs}} \text{ wins } \mathsf{IBS \mhyphen EUF
      \mhyphen CMA}] = \frac{b}{3np}
    \end{equation*}
  \end{proof}

  \begin{figure}[H]
    \begin{algobox}{\textsf{share-EUF} forgery}
      \begin{algorithmic}[1]
        \State bla
      \end{algorithmic}
    \end{algobox}
    \caption{wins \textsf{share-EUF} game when $\Pr[R] = a$}
    \label{alg:forge:share}
  \end{figure}

  \begin{figure}[H]
    \begin{algobox}{\textsf{master-EUF-CMA} forgery}
      \begin{algorithmic}[1]
        \State bla
      \end{algorithmic}
    \end{algobox}
    \caption{wins \textsf{master-EUF-CMA} game when $\Pr[S] = a$}
    \label{alg:forge:master}
  \end{figure}
